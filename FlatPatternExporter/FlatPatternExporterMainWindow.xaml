<Window x:Class="FlatPatternExporter.FlatPatternExporterMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"        
        xmlns:local="clr-namespace:FlatPatternExporter"
        PreviewMouseLeftButtonDown="MainWindow_PreviewMouseLeftButtonDown"
        Title="FPEx" Width="1740"
        MinHeight="850" MinWidth="1410"
        WindowStartupLocation="CenterScreen" ResizeMode="CanResizeWithGrip" Height="850">

    <Window.Resources>
        <ResourceDictionary>
            <!-- Подключение внешнего файла стилей -->
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Styles/DataGridStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

        <!-- Стиль для фантомного заголовка колонки при перетаскивании -->
        <Style x:Key="PhantomColumnHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Opacity" Value="0.7"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
            <Setter Property="Background" Value="LightGray"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="Normal"/>
        </Style>

        <!-- Стиль для фантомного заголовка в режиме удаления -->
        <Style x:Key="PhantomColumnHeaderDeleteStyle" TargetType="TextBlock" BasedOn="{StaticResource PhantomColumnHeaderStyle}">
            <Setter Property="Background" Value="Red"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>

        <!-- Стили для блока информации о документе -->
        <Style x:Key="DocumentInfoLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,3,1"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="DocumentInfoValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="0,0,0,1"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="ModelStateValueStyle" TargetType="TextBlock" BasedOn="{StaticResource DocumentInfoValueStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPrimaryModelState}" Value="False">
                    <Setter Property="Foreground" Value="Red"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="100" />
            <RowDefinition Height="210"/>
            <RowDefinition />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="25" />
        </Grid.RowDefinitions>
        <Button x:Name="AddPresetIPropertyButton" Content="+ Property" Click="AddPresetIPropertyButton_Click" Height="32.5" Margin="265,0,10,48" VerticalAlignment="Bottom" HorizontalAlignment="Left" Width="115" HorizontalContentAlignment="Left" Padding="5,1,1,1"/>
        <Button Grid.Row="0" Name="ConflictFilesButton" 
                IsEnabled="False" 
                Click="ConflictFilesButton_Click" 
                Width="100" 
                Height="75" 
                VerticalAlignment="Bottom" 
                HorizontalAlignment="Left" 
                Margin="390,0,0,5">
            <Button.Content>
                <TextBlock Text="Анализ обозначений" 
                           TextWrapping="Wrap" 
                           TextAlignment="Center"/>
            </Button.Content>
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="BorderBrush" Value="Gray"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Style.Triggers>
                        <Trigger Property="IsEnabled" Value="True">
                            <Setter Property="BorderBrush" Value="#FFFF2929"/>
                            <Setter Property="BorderThickness" Value="1"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>
        <GroupBox Header="Поиск" 
                  HorizontalAlignment="Right" 
                  VerticalAlignment="Top" 
                  Width="200" 
                  Margin="0,5,90,0"
                  Padding="10"
                  Grid.Row="0">
            <Grid>
                <TextBox x:Name="SearchTextBox" 
                         Height="25"
                         Padding="5,0,30,0"
                         VerticalContentAlignment="Center"
                         TextChanged="SearchTextBox_TextChanged"/>
                <TextBlock Text="Поиск..." 
                           Foreground="Gray" 
                           VerticalAlignment="Center" 
                           Margin="5,0,30,0"
                           IsHitTestVisible="False">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Text, ElementName=SearchTextBox}" Value="">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <Button x:Name="ClearSearchButton" 
                        Content="✖"
                        Width="20"
                        Height="20"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center" 
                        Click="ClearSearchButton_Click" 
                        FontSize="8" 
                        Background="Transparent" 
                        BorderBrush="Transparent"
                        Visibility="Collapsed"/>
            </Grid>
        </GroupBox>
        <DataGrid x:Name="PartsDataGrid"
              AutoGenerateColumns="False"
              Margin="10,0,10,10"
              IsReadOnly="True"
              CanUserAddRows="False"
              Grid.Row="2"
              RowHeight="50"
              GridLinesVisibility="None"
              Background="White"
              VerticalAlignment="Top"
              BorderBrush="#D6D6D6"
              BorderThickness="1"
              HorizontalGridLinesBrush="#EAEAEA"
              VerticalGridLinesBrush="#EAEAEA"
              SelectionMode="Extended"
              SelectionChanged="partsDataGrid_SelectionChanged"
              Drop="partsDataGrid_Drop" 
              AllowDrop="True"
              RowHeaderWidth="0"
              ContextMenuOpening="partsDataGrid_ContextMenuOpening"
              RowStyle="{StaticResource DataGridRowStyle}"
              ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
              RowHeaderStyle="{StaticResource DataGridRowHeaderStyle}"
              CellStyle="{StaticResource DataGridCellStyle}">

            <!-- Контекстное меню -->
            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Экспортировать выбранные DXF" Click="ExportSelectedDXF_Click"/>
                    <MenuItem Header="Переопределить количество" Click="OverrideQuantity_Click"/>
                    <Separator/>
                    <MenuItem Header="Открыть расположение файла" Click="OpenFileLocation_Click"/>
                    <MenuItem Header="Открыть выбранные модели" Click="OpenSelectedModels_Click"/>
                    <Separator/>
                    <MenuItem Header="Редактировать iProperty" Click="EditIProperty_Click" x:Name="EditIPropertyMenuItem"/>
                    <Separator/>
                    <MenuItem Header="Очистить список" Click="ClearList_Click"/>
                </ContextMenu>
            </DataGrid.ContextMenu>


            <DataGrid.Columns>
                <!-- Колонка с индикатором обработки -->
                <DataGridTemplateColumn Header="Обр." Width="Auto" IsReadOnly="False" CanUserSort="False" CanUserReorder="False"
                                      CellTemplate="{StaticResource ProcessingStatusTemplate}"/>
            </DataGrid.Columns>
        </DataGrid>
        <StackPanel Margin="10,10,10,0" Grid.Row="3" VerticalAlignment="Top">
            <ProgressBar x:Name="ProgressBar" Height="20" Margin="0,0,0,10"/>
        </StackPanel>
        <TextBlock x:Name="ProgressLabel" Grid.Row="3" Text="Статус: " 
                   Margin="10,40,10,10" HorizontalAlignment="Left" VerticalAlignment="Top" 
                   TextWrapping="Wrap" Height="Auto" MaxWidth="800"/>
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10,20,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" Height="75" Width="245">
            <Button x:Name="ScanButton" Content="Сканировать" Click="ScanButton_Click" Margin="0,0,10,0" Height="75" Width="75" BorderThickness="1,1,1,1" RenderTransformOrigin="0,0"/>
            <StackPanel Width="75" Margin="0,0,10,0">
                <Button x:Name="CancelButton" Content="Прервать" Click="CancelButton_Click" IsEnabled="False" Width="75" Height="32.5" VerticalAlignment="Top" Margin="0,0,0,10"/>
                <Button x:Name="ClearButton" Content="Очистить" Click="ClearList_Click" IsEnabled="True" Width="75" Height="32.5" VerticalAlignment="Bottom"/>
            </StackPanel>
            <Button x:Name="ExportButton" Content="Экспорт" Click="ExportButton_Click" IsEnabled="False" Width="75" Height="75" ToolTipService.ShowOnDisabled="True" ToolTip="Зажмите CTRL что бы начать экспорт без предварителього сканирования"/>
        </StackPanel>
        <Border Grid.Row="0" Margin="500,20,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="300" Height="75"
                BorderBrush="#D0D0D0" BorderThickness="1" Background="#F8F8F8" Padding="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="Тип документа:" Style="{StaticResource DocumentInfoLabelStyle}" FontWeight="Normal" Height="16" Margin="0,0,3,0"/>
                <TextBlock x:Name="DocumentTypeLabel" Grid.Column="1" Text="" Style="{StaticResource DocumentInfoValueStyle}" Height="15" Margin="5,0,0,1"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Обозначение:" Style="{StaticResource DocumentInfoLabelStyle}" FontWeight="Normal" Height="14" Margin="0,0,3,0"/>
                <TextBlock x:Name="PartNumberLabel" Grid.Row="1" Grid.Column="1" Text="" Style="{StaticResource DocumentInfoValueStyle}" Height="14" Margin="5,0,0,1"/>

                <TextBlock Grid.Row="2" Grid.Column="0" Text="Описание:" Style="{StaticResource DocumentInfoLabelStyle}" FontWeight="Normal" Height="14" Margin="0,0,3,0"/>
                <TextBlock x:Name="DescriptionLabel" Grid.Row="2" Grid.Column="1" Text="" Style="{StaticResource DocumentInfoValueStyle}" Height="15" Margin="5,0,0,1"/>

                <TextBlock Grid.Row="3" Grid.Column="0" Text="Состояние модели:" Style="{StaticResource DocumentInfoLabelStyle}" FontWeight="Normal" Height="14" Margin="0,0,3,0"/>
                <TextBlock x:Name="ModelStateLabel" Grid.Row="3" Grid.Column="1" Text="" 
                           Style="{StaticResource ModelStateValueStyle}" Height="15" Margin="5,0,0,1"/>
            </Grid>
        </Border>
        <Border Grid.Row="4" Background="LightGray" Height="25" VerticalAlignment="Center">
            <StackPanel x:Name="BottomPanel" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left" Opacity="0.75">
                <TextBlock x:Name="ProjectName" Text="Проект: " Foreground="Black" Margin="10,0"/>
                <Separator Width="16" Margin="10,0,10,0" Background="#FFADADAD" UseLayoutRounding="False" Cursor="" VerticalContentAlignment="Center" ScrollViewer.VerticalScrollBarVisibility="Disabled" RenderTransformOrigin="0.5,0.5">
                    <Separator.RenderTransform>
                        <TransformGroup>
                            <RotateTransform Angle="-90"/>
                            <TranslateTransform/>
                        </TransformGroup>
                    </Separator.RenderTransform>
                </Separator>
                <TextBlock x:Name="FileCountLabelBottom" Text="Найдено файлов для экспорта: " Foreground="Black" Margin="10,0"/>
            </StackPanel>
        </Border>
        <TabControl Margin="10,10,10,10" Grid.Row="1">
            <TabItem Header="Основные">
                <Grid Background="White">
                    <GroupBox Header="Фильтрация компонентов" Margin="1220,10,0,0" Height="140" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <StackPanel Margin="10,5,10,5">
                            <CheckBox x:Name="ExcludeReferencePartsCheckBox" Content="Исключить ссылочные" IsChecked="{Binding ExcludeReferenceParts, Mode=TwoWay}" Margin="0,0,0,5"/>
                            <CheckBox x:Name="ExcludePurchasedPartsCheckBox" Content="Исключить покупные" IsChecked="{Binding ExcludePurchasedParts, Mode=TwoWay}" Margin="0,0,0,5"/>
                            <CheckBox x:Name="IncludeLibraryComponentsCheckBox" Content="Включить библиотечные компоненты" IsChecked="{Binding IncludeLibraryComponents, Mode=TwoWay}" Margin="0,0,0,5"/>
                        </StackPanel>
                    </GroupBox>
                    <GroupBox Header="Папка экспорта" Margin="732,10,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" Height="140">
                        <Grid Margin="10,5,10,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="85*"/>
                                <RowDefinition Height="27*"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Левая колонка -->
                            <StackPanel Orientation="Vertical" Grid.Column="0">
                                <RadioButton x:Name="ChooseFolderRadioButton" Content="Указать папку в процессе экспорта" Margin="0,5,0,0" GroupName="ExportFolderOptions" IsChecked="{Binding SelectedExportFolder, Converter={x:Static local:EnumToBooleanConverter.Instance}, ConverterParameter=ChooseFolder, Mode=TwoWay}" />
                                <RadioButton x:Name="ComponentFolderRadioButton" Content="Папка компонента" Margin="0,5,0,0" GroupName="ExportFolderOptions" IsChecked="{Binding SelectedExportFolder, Converter={x:Static local:EnumToBooleanConverter.Instance}, ConverterParameter=ComponentFolder, Mode=TwoWay}" />
                                <RadioButton x:Name="PartFolderRadioButton" Content="Рядом с деталью" Margin="0,5,0,0" GroupName="ExportFolderOptions" IsChecked="{Binding SelectedExportFolder, Converter={x:Static local:EnumToBooleanConverter.Instance}, ConverterParameter=PartFolder, Mode=TwoWay}" />
                                <RadioButton x:Name="ProjectFolderRadioButton" Content="Папка проекта" VerticalAlignment="Center" GroupName="ExportFolderOptions" IsChecked="{Binding SelectedExportFolder, Converter={x:Static local:EnumToBooleanConverter.Instance}, ConverterParameter=ProjectFolder, Mode=TwoWay}" Margin="0,5,0,0" />
                            </StackPanel>
                            <!-- Правая колонка -->
                            <StackPanel Grid.Row="0" Grid.Column="1">
                                <CheckBox x:Name="EnableSubfolderCheckBox" Content="Создать подпапку" VerticalAlignment="Center" IsChecked="{Binding EnableSubfolder, Mode=TwoWay}" IsEnabled="{Binding IsSubfolderCheckBoxEnabled}" ToolTip="Недопустимые символы: \ / : * ? &quot; &lt; &gt; |" Margin="50,5,0,0" HorizontalAlignment="Left" />
                                <TextBox x:Name="SubfolderNameTextBox" Width="118" Height="20" IsEnabled="{Binding EnableSubfolder}" TextChanged="SubfolderNameTextBox_TextChanged" HorizontalAlignment="Left" Margin="50,5,0,0" />
                                <CheckBox x:Name="OrganizeByMaterialCheckBox" Content="Сортировать по материалу" IsChecked="{Binding OrganizeByMaterial, Mode=TwoWay}" Margin="50,5,0,0"/>
                                <CheckBox x:Name="OrganizeByThicknessCheckBox" Content="Сортировать по толщине" IsChecked="{Binding OrganizeByThickness, Mode=TwoWay}" Margin="50,5,0,0"/>
                            </StackPanel>

                            <StackPanel Grid.Row="1" VerticalAlignment="Center" Orientation="Horizontal" HorizontalAlignment="Left" Grid.ColumnSpan="2"
                                        Grid.Column="0">
                                <RadioButton x:Name="FixedFolderRadioButton" Content="Фиксированная папка" VerticalAlignment="Center" GroupName="ExportFolderOptions" IsChecked="{Binding SelectedExportFolder, Converter={x:Static local:EnumToBooleanConverter.Instance}, ConverterParameter=FixedFolder, Mode=TwoWay}" />
                                <Button x:Name="SelectFixedFolderButton" Content="..." Width="30" Height="20" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,0,0" Click="SelectFixedFolderButton_Click" />
                                <TextBlock x:Name="FixedFolderPathTextBlock" Text="Путь не выбран" Margin="10,0,0,0" TextTrimming="CharacterEllipsis" Opacity="0.75" VerticalAlignment="Center" Width="260" />
                            </StackPanel>

                        </Grid>
                    </GroupBox>


                    <GroupBox Header="Базовые настройки" Margin="10,10,0,0" Height="140" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <StackPanel Margin="10,5,10,5" HorizontalAlignment="Center" VerticalAlignment="Top">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <RadioButton x:Name="TraverseRadioButton" Content="Перебор" IsChecked="{Binding SelectedProcessingMethod, Converter={x:Static local:EnumToBooleanConverter.Instance}, ConverterParameter=Traverse, Mode=TwoWay}" Margin="0,0,10,0"/>
                                <RadioButton x:Name="BomRadioButton" Content="Спецификация" IsChecked="{Binding SelectedProcessingMethod, Converter={x:Static local:EnumToBooleanConverter.Instance}, ConverterParameter=BOM, Mode=TwoWay}"/>
                            </StackPanel>
                            <CheckBox x:Name="IncludeQuantityInFileNameCheckBox" Content="Записать количество в имя файла" IsChecked="{Binding IncludeQuantityInFileName, Mode=TwoWay}" Margin="0,0,0,5"/>
                        </StackPanel>
                    </GroupBox>
                    <GroupBox Header="Настройки экспорта DXF" Margin="254,10,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" Height="140">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" Margin="10,5,10,0">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Content="Версия AutoCAD:" VerticalAlignment="Center"/>
                                <ComboBox x:Name="AcadVersionComboBox" 
                                          Width="70" 
                                          Height="20" 
                                          VerticalContentAlignment="Center" 
                                          Padding="5,0,5,0"
                                          ItemsSource="{Binding AcadVersions}"
                                          DisplayMemberPath="DisplayName"
                                          SelectedValuePath="Value"
                                          SelectedIndex="{Binding SelectedAcadVersionIndex, Mode=TwoWay}"/>
                            </StackPanel>
                            <CheckBox x:Name="MergeProfilesIntoPolylineCheckBox" Content="Объеденить контуры с полилиниями" Margin="0,0,0,5" IsChecked="{Binding MergeProfilesIntoPolyline, Mode=TwoWay}"/>
                            <CheckBox x:Name="RebaseGeometryCheckBox" Content="Переместить геометрию в первый квадрант" Margin="0,0,0,5" IsChecked="{Binding RebaseGeometry, Mode=TwoWay}"/>
                            <CheckBox x:Name="TrimCenterlinesCheckBox" Content="Обрезать осевые линии по контуру" Margin="0,0,0,5" IsChecked="{Binding TrimCenterlines, Mode=TwoWay}"/>
                        </StackPanel>
                    </GroupBox>
                    <StackPanel Orientation="Horizontal" Margin="0,0,10,10" Height="25" VerticalAlignment="Bottom" HorizontalAlignment="Right" Width="134">
                        <Label Content="Множитель" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <Grid Width="50">
                            <!-- Размер поля ввода вернулся к 50 -->
                            <TextBox x:Name="MultiplierTextBox" Width="50" IsEnabled="{Binding IsChecked, ElementName=IncludeQuantityInFileNameCheckBox}" Text="1" Height="22" VerticalAlignment="Center" 
                 PreviewTextInput="MultiplierTextBox_PreviewTextInput" 
                 VerticalContentAlignment="Center" 
                 TextChanged="MultiplierTextBox_TextChanged"/>
                            <Button x:Name="ClearMultiplierButton" 
                Content="✖" 
                Width="20" 
                Height="20" 
                HorizontalAlignment="Right" 
                VerticalAlignment="Center" 
                Click="ClearMultiplierButton_Click" 
                FontSize="8" 
                Background="{x:Null}" 
                Visibility="Collapsed" 
                ToolTip="Сбросить множитель на 1">
                                <Button.BorderBrush>
                                    <SolidColorBrush Color="#FF707070" Opacity="0"/>
                                </Button.BorderBrush>
                            </Button>
                        </Grid>
                    </StackPanel>
                    <GroupBox Header="Замена сплайнов " Margin="555,10,0,0" Height="140" HorizontalAlignment="Left" VerticalAlignment="Top">
                        <StackPanel Orientation="Vertical" Margin="10,5,10,0" VerticalAlignment="Top" HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <CheckBox x:Name="EnableSplineReplacementCheckBox" Content="Активация" IsChecked="{Binding EnableSplineReplacement, Mode=TwoWay}" VerticalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Content="Тип замены:" VerticalAlignment="Center" Padding="0,5,5,5"/>
                                <ComboBox x:Name="SplineReplacementComboBox" 
                                          Width="65" 
                                          VerticalContentAlignment="Center" 
                                          IsEnabled="{Binding IsChecked, ElementName=EnableSplineReplacementCheckBox}" 
                                          Height="20" 
                                          Padding="5,0,5,0" 
                                          Margin="2,0,0,0"
                                          ItemsSource="{Binding SplineReplacementTypes}"
                                          DisplayMemberPath="DisplayName"
                                          SelectedValuePath="Index"
                                          SelectedIndex="{Binding SelectedSplineReplacementIndex, Mode=TwoWay}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Content="Допуск (мм):" VerticalAlignment="Center" Padding="0,5,5,5"/>
                                <TextBox x:Name="SplineToleranceTextBox" Width="65" Text="0.01" VerticalContentAlignment="Center" IsEnabled="{Binding IsChecked, ElementName=EnableSplineReplacementCheckBox}" Height="20"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </TabItem>
            <TabItem Header="Настройка слоев">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="210"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Margin="10,0,10,0">
                        <local:LayerSettingControl x:Name="OuterProfileLayerControl" DataContext="{Binding LayerSettings[5]}" Pseudonym="OuterProfile"/>
                        <local:LayerSettingControl x:Name="InteriorProfilesLayerControl" DataContext="{Binding LayerSettings[6]}" Pseudonym="InteriorProfiles"/>
                        <local:LayerSettingControl x:Name="BendUpLayerControl" DataContext="{Binding LayerSettings[0]}" Pseudonym="BendUp"/>
                        <local:LayerSettingControl x:Name="BendDownLayerControl" DataContext="{Binding LayerSettings[1]}" Pseudonym="BendDown"/>
                        <local:LayerSettingControl x:Name="ToolCenterUpLayerControl" DataContext="{Binding LayerSettings[2]}" Pseudonym="ToolCenterUp"/>
                        <local:LayerSettingControl x:Name="ToolCenterDownLayerControl" DataContext="{Binding LayerSettings[3]}" Pseudonym="ToolCenterDown"/>
                    </StackPanel>
                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,10,0">
                        <local:LayerSettingControl x:Name="TangentLayerControl" DataContext="{Binding LayerSettings[12]}" Pseudonym="Tangent"/>
                        <local:LayerSettingControl x:Name="RollLinesLayerControl" DataContext="{Binding LayerSettings[14]}" Pseudonym="RollLines"/>
                        <local:LayerSettingControl x:Name="TangentRollLinesLayerControl" DataContext="{Binding LayerSettings[13]}" Pseudonym="TangentRollLines"/>
                        <local:LayerSettingControl x:Name="ArcCentersLayerControl" DataContext="{Binding LayerSettings[4]}" Pseudonym="ArcCenters"/>
                        <local:LayerSettingControl x:Name="FeatureProfilesUpLayerControl" DataContext="{Binding LayerSettings[7]}" Pseudonym="FeatureProfilesUp"/>
                        <local:LayerSettingControl x:Name="FeatureProfilesDownLayerControl" DataContext="{Binding LayerSettings[8]}" Pseudonym="FeatureProfilesDown"/>
                    </StackPanel>
                    <StackPanel Grid.Row="0" Grid.Column="2" Margin="10,0,10,0">
                        <local:LayerSettingControl x:Name="UnconsumedSketchConstructionLayerControl" DataContext="{Binding LayerSettings[15]}" Pseudonym="UnconsumedSketchConstruction"/>
                        <local:LayerSettingControl x:Name="UnconsumedSketchesLayerControl" DataContext="{Binding LayerSettings[11]}" Pseudonym="UnconsumedSketches"/>
                        <local:LayerSettingControl x:Name="AltRepFrontLayerControl" DataContext="{Binding LayerSettings[9]}" Pseudonym="AltRepFront"/>
                        <local:LayerSettingControl x:Name="AltRepBackLayerControl" DataContext="{Binding LayerSettings[10]}" Pseudonym="AltRepBack"/>
                    </StackPanel>
                    <Separator Background="#FF969595" RenderTransformOrigin="0.5,0.5" HorizontalAlignment="Center" Width="185"
                               Grid.Row="0" Grid.ColumnSpan="2" Grid.Column="0" Margin="0,5,0,20">
                        <Separator.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform/>
                                <SkewTransform/>
                                <RotateTransform Angle="90"/>
                                <TranslateTransform/>
                            </TransformGroup>
                        </Separator.RenderTransform>
                    </Separator>
                    <Separator Background="#FF969595" RenderTransformOrigin="0.5,0.5" HorizontalAlignment="Center" Width="185"
                               Grid.Row="0" Grid.ColumnSpan="2" Margin="0,5,0,20" Grid.Column="1">
                        <Separator.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform/>
                                <SkewTransform/>
                                <RotateTransform Angle="90"/>
                                <TranslateTransform/>
                            </TransformGroup>
                        </Separator.RenderTransform>
                    </Separator>
                </Grid>
            </TabItem>
            <TabItem Header="Имя выгружаемого файла"/>
        </TabControl>
        <TextBlock Name="VersionTextBlock" VerticalAlignment="Center" Margin="0,0,25,0" HorizontalAlignment="Right" Text="Версия программы: x.x.x.x + xxxxxxx" Grid.Row="4"/>
        <Button Content="About" Click="AboutButton_Click" Margin="0,14,10,186" FontSize="10" HorizontalAlignment="Right" Padding="1,1,1,1" Width="73" FontFamily="Tahoma" VerticalContentAlignment="Top" Cursor="Help" Grid.RowSpan="2" FontWeight="Bold">
            <Button.Background>
                <ImageBrush ImageSource="/Resources/Pic/Beta1.png" TileMode="None" Stretch="Uniform" Opacity="1">
                    <ImageBrush.RelativeTransform>
                        <TransformGroup>
                            <ScaleTransform CenterY="0.75" CenterX="0.5" ScaleY="0.75" ScaleX="0.75"/>
                            <SkewTransform CenterX="0.5" CenterY="0.75"/>
                            <RotateTransform CenterX="0.5" CenterY="0.75"/>
                            <TranslateTransform/>
                        </TransformGroup>
                    </ImageBrush.RelativeTransform>
                </ImageBrush>
            </Button.Background>
            <Button.Style>
                <Style TargetType="Button">
                    <!-- Убираем стандартный фон при наведении -->
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderBrush" Value="#FFACACAC"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,5,0,0"/>
                                    <!-- Прижимаем текст к верху -->
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>

                    <!-- Триггер для изменения границы при наведении -->
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="BorderBrush" Value="#0078D4"/>
                            <!-- Цвет границы при наведении -->
                            <Setter Property="BorderThickness" Value="1"/>
                            <!-- Увеличиваем толщину границы -->
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter Property="BorderBrush" Value="#003778"/>
                            <!-- Цвет границы при нажатии -->
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>
    </Grid>
</Window>
