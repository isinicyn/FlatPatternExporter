<Window x:Class="FlatPatternExporter.FlatPatternExporterMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:layer="clr-namespace:FlatPatternExporter"
        PreviewMouseLeftButtonDown="MainWindow_PreviewMouseLeftButtonDown"
        Title="FPEx" Width="1740"
        MinHeight="850" MinWidth="1410"
        WindowStartupLocation="CenterScreen" ResizeMode="CanResizeWithGrip" Height="850">

    <Window.Resources>
        <!-- Стиль для фантомного заголовка колонки при перетаскивании -->
        <Style x:Key="PhantomColumnHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Opacity" Value="0.7"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
            <Setter Property="Background" Value="LightGray"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="Normal"/>
        </Style>
        
        <!-- Стиль для фантомного заголовка в режиме удаления -->
        <Style x:Key="PhantomColumnHeaderDeleteStyle" TargetType="TextBlock" BasedOn="{StaticResource PhantomColumnHeaderStyle}">
            <Setter Property="Background" Value="Red"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="100" />
            <RowDefinition Height="210"/>
            <RowDefinition />
            <RowDefinition Height="125" />
            <RowDefinition Height="25" />
        </Grid.RowDefinitions>
        <Button x:Name="AddPresetIPropertyButton" Content="+ iProperty" Click="AddPresetIPropertyButton_Click" Height="32.5" Margin="265,0,10,48" VerticalAlignment="Bottom" HorizontalAlignment="Left" Width="115" HorizontalContentAlignment="Left" Padding="5,1,1,1"/>
        <Button Grid.Row="0" Name="ConflictFilesButton" 
                IsEnabled="False" 
                Click="ConflictFilesButton_Click" 
                Width="100" 
                Height="75" 
                VerticalAlignment="Bottom" 
                HorizontalAlignment="Left" 
                Margin="390,0,0,5">
            <Button.Content>
                <TextBlock Text="Анализ обозначений" 
                           TextWrapping="Wrap" 
                           TextAlignment="Center"/>
            </Button.Content>
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="BorderBrush" Value="Gray"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Style.Triggers>
                        <Trigger Property="IsEnabled" Value="True">
                            <Setter Property="BorderBrush" Value="#FFFF2929"/>
                            <Setter Property="BorderThickness" Value="1"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>
        <GroupBox Header="Список данных деталей" ScrollViewer.VerticalScrollBarVisibility="Disabled" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" BorderThickness="1,1,1,1" HorizontalAlignment="Right" VerticalAlignment="Top" Padding="5,0,5,0" Height="120" Margin="0,5,90,0"
                  Grid.Row="0" Grid.RowSpan="2">
            <StackPanel VerticalAlignment="Center">
                <StackPanel x:Name="StackPanel">
                    <Grid Margin="0,0,0,10" VerticalAlignment="Center" Width="{Binding Width, ElementName=StackPanel}">
                        <TextBox x:Name="SearchTextBox" 
                         VerticalContentAlignment="Center"
                         Padding="5,0,30,0"
                         TextChanged="SearchTextBox_TextChanged"
                         VerticalAlignment="Center" Height="20">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TextBox">
                                                <Border Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}">
                                                    <Grid>
                                                        <ScrollViewer x:Name="PART_ContentHost" 
                                                                      VerticalAlignment="Center" 
                                                                      Margin="{TemplateBinding Padding}"/>
                                                        <TextBlock Text="Поиск..." 
                                                                   Foreground="Gray" 
                                                                   VerticalAlignment="Center" 
                                                                   Margin="{TemplateBinding Padding}"
                                                                   IsHitTestVisible="False">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}" Value="">
                                                                            <Setter Property="Visibility" Value="Visible"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </Grid>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                        <Button x:Name="ClearSearchButton" 
                        Content="✖"
                        Width="20"
                        Height="20"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center" 
                        Click="ClearSearchButton_Click" FontSize="8" Background="{x:Null}" Visibility="Collapsed">
                            <Button.BorderBrush>
                                <SolidColorBrush Color="#FF707070" Opacity="0"/>
                            </Button.BorderBrush>
                        </Button>
                    </Grid>
                </StackPanel>
            </StackPanel>
        </GroupBox>
        <DataGrid x:Name="PartsDataGrid"
              AutoGenerateColumns="False"
              Margin="10,0,10,10"
              IsReadOnly="True"
              CanUserAddRows="False"
              Grid.Row="2"
              RowHeight="50"
              GridLinesVisibility="None"
              Background="White"
              VerticalAlignment="Top"
              BorderBrush="#D6D6D6"
              BorderThickness="1"
              HorizontalGridLinesBrush="#EAEAEA"
              VerticalGridLinesBrush="#EAEAEA"
              SelectionMode="Extended"
              SelectionChanged="partsDataGrid_SelectionChanged"
              Drop="partsDataGrid_Drop" 
              AllowDrop="True"
              RowHeaderWidth="0"
              AlternatingRowBackground="#F5F5F5"
              ContextMenuOpening="partsDataGrid_ContextMenuOpening">

            <!-- Контекстное меню -->
            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Экспортировать выбранные DXF" Click="ExportSelectedDXF_Click"/>
                    <MenuItem Header="Переопределить количество" Click="OverrideQuantity_Click"/>
                    <Separator/>
                    <MenuItem Header="Открыть расположение файла" Click="OpenFileLocation_Click"/>
                    <MenuItem Header="Открыть выбранные модели" Click="OpenSelectedModels_Click"/>
                    <Separator/>
                    <MenuItem Header="Редактировать iProperty" Click="EditIProperty_Click" x:Name="EditIPropertyMenuItem"/>
                    <Separator/>
                    <MenuItem Header="Очистить список" Click="ClearList_Click"/>
                </ContextMenu>
            </DataGrid.ContextMenu>

            <DataGrid.Resources>


                <!-- Общий стиль для TextBlock внутри ячеек -->
                <Style x:Key="CenteredCellStyle" TargetType="TextBlock">
                    <Setter Property="Padding" Value="10,5"/>
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                </Style>

                <!-- Специальный стиль для колонки количества -->
                <Style x:Key="QuantityCellStyle" TargetType="TextBlock" BasedOn="{StaticResource CenteredCellStyle}">
                    <Style.Triggers>
                        <!-- Приоритетный триггер для переопределенного количества (красный цвет) -->
                        <DataTrigger Binding="{Binding IsOverridden}" Value="True">
                            <Setter Property="Foreground" Value="Red"/>
                        </DataTrigger>
                        <!-- Триггер для множителя (синий цвет) -->
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsOverridden}" Value="False"/>
                                <Condition Binding="{Binding IsMultiplied}" Value="True"/>
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Foreground" Value="Blue"/>
                        </MultiDataTrigger>
                    </Style.Triggers>
                </Style>

                <!-- Стиль для индикатора развертки -->
                <Style x:Key="FlatPatternIndicatorStyle" TargetType="Border">
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                    <Setter Property="Width" Value="20"/>
                    <Setter Property="Height" Value="20"/>
                    <Setter Property="Padding" Value="10,5"/>
                    <Setter Property="Background" Value="Red"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding HasFlatPattern}" Value="True">
                            <Setter Property="Background" Value="Green"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>

                <Style TargetType="DataGridRow">
                    <Style.Resources>
                        <!-- Стиль для выделенной строки -->
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="LightBlue"/>
                        <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="LightBlue"/>
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black"/>
                    </Style.Resources>
                    <Style.Triggers>
                        <Trigger Property="AlternationIndex" Value="0">
                            <Setter Property="Background" Value="White"/>
                        </Trigger>
                        <Trigger Property="AlternationIndex" Value="1">
                            <Setter Property="Background" Value="#F5F5F5"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>

                <!-- Стиль для заголовков столбцов -->
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#F2F2F2"/>
                    <Setter Property="Foreground" Value="#333333"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Padding" Value="10,5"/>
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                    <Setter Property="BorderBrush" Value="#FFE0DDDD"/>
                    <Setter Property="BorderThickness" Value="0,0,1,0"/>
                    <Setter Property="ContextMenu" Value="{x:Null}"/>
                </Style>

                <!-- Стиль для заголовка строки (кнопка выделения всей строки) -->
                <Style TargetType="DataGridRowHeader">
                    <Setter Property="Background" Value="#F2F2F2"/>
                    <Setter Property="BorderBrush" Value="#FFE0DDDD"/>
                    <Setter Property="BorderThickness" Value="0,0,1,1"/>
                    <Setter Property="Width" Value="15"/>
                    <Setter Property="ContextMenu" Value="{x:Null}"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="DataGridRowHeader">
                                <Grid>
                                    <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>

                <!-- Стиль для ячеек строк -->
                <Style TargetType="DataGridCell">
                    <Style.Resources>
                        <!-- Стиль для выделенной ячейки -->
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="LightBlue"/>
                        <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="LightBlue"/>
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black"/>
                    </Style.Resources>
                    <Setter Property="Padding" Value="10,5"/>
                    <Setter Property="BorderBrush" Value="#EAEAEA"/>
                    <Setter Property="BorderThickness" Value="0,0,1,1"/>
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                    <Setter Property="Foreground" Value="#333333"/>
                </Style>

                <!-- Стиль для текста внутри ячеек -->
                <Style TargetType="TextBlock">
                    <Setter Property="Padding" Value="5,2"/>
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                    <Setter Property="Foreground" Value="#333333"/>
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>

                <!-- Колонка с номером пункта -->
                <DataGridTextColumn Header="ID" Binding="{Binding Item, Mode=OneWay}" Width="Auto" SortMemberPath="Item" SortDirection="Ascending">
                    <DataGridTextColumn.ElementStyle>
                        <StaticResource ResourceKey="CenteredCellStyle"/>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <!-- Колонка с обозначением детали и индикатором развертки -->
                <DataGridTemplateColumn Header="Обозначение" Width="Auto" SortMemberPath="PartNumber">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="7"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Rectangle Grid.Column="0" Width="3" HorizontalAlignment="Left" VerticalAlignment="Stretch" Margin="2,0,0,0">
                                    <Rectangle.Style>
                                        <Style TargetType="Rectangle">
                                            <Setter Property="Fill" Value="Red"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding HasFlatPattern}" Value="True">
                                                    <Setter Property="Fill" Value="Green"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Rectangle.Style>
                                </Rectangle>
                                <TextBlock Grid.Column="1" Text="{Binding PartNumber}" VerticalAlignment="Center" HorizontalAlignment="Center" Style="{StaticResource CenteredCellStyle}" TextTrimming="CharacterEllipsis"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Колонка с наименованием детали -->
                <DataGridTextColumn Header="Наименование" Binding="{Binding Description}" Width="Auto" SortMemberPath="Description">
                    <DataGridTextColumn.ElementStyle>
                        <StaticResource ResourceKey="CenteredCellStyle"/>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Колонка с состоянием модели -->
                <DataGridTextColumn Header="Состояние модели" Binding="{Binding ModelState}" Width="Auto">
                    <DataGridTextColumn.ElementStyle>
                        <StaticResource ResourceKey="CenteredCellStyle"/>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Колонка с материалом детали -->
                <DataGridTextColumn Header="Материал" Binding="{Binding Material}" Width="Auto">
                    <DataGridTextColumn.ElementStyle>
                        <StaticResource ResourceKey="CenteredCellStyle"/>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Колонка с толщиной материала -->
                <DataGridTextColumn Header="Толщина" Binding="{Binding Thickness, StringFormat=F1}" Width="Auto">
                    <DataGridTextColumn.ElementStyle>
                        <StaticResource ResourceKey="CenteredCellStyle"/>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Колонка с количеством деталей -->
                <DataGridTextColumn Header="Кол." Binding="{Binding Quantity}" Width="Auto">
                    <DataGridTextColumn.ElementStyle>
                        <StaticResource ResourceKey="QuantityCellStyle"/>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Колонка с изображением детали -->
                <DataGridTemplateColumn Header="Изобр. детали" Width="Auto">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Image Source="{Binding Preview}" Height="50" Width="50" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Колонка с изображением развертки -->
                <DataGridTemplateColumn Header="Изобр. развертки" Width="Auto">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid Width="50" Height="50">
                                <Image Source="{Binding DxfPreview}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Text="Нет миниатюры" 
                                           HorizontalAlignment="Center" 
                                           VerticalAlignment="Center" 
                                           FontSize="8" 
                                           Foreground="Gray"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding DxfPreview}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Колонка с индикатором обработки -->
                <DataGridTemplateColumn Header="Обр." Width="Auto" IsReadOnly="False" CanUserSort="False" CanUserReorder="False">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border x:Name="ProcessingStatus" Width="10" Height="10" BorderBrush="DarkGray" BorderThickness="1" Background="{Binding ProcessingColor}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
        <StackPanel Margin="10,10,10,0" Grid.Row="3" VerticalAlignment="Top">
            <ProgressBar x:Name="ProgressBar" Height="20" Margin="0,0,0,10"/>
        </StackPanel>
        <StackPanel Grid.Row="3" Margin="10,40,0,10" HorizontalAlignment="Left" Width="250">
            <TextBlock x:Name="ProgressLabel" Text="Статус: " Margin="0,0,0,10"/>
            <TextBlock>
                <Run x:Name="DocumentInfoLabel" Text="" Foreground="Black"/>
            </TextBlock>
        </StackPanel>
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10,20,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" Height="75" Width="245">
            <Button x:Name="ScanButton" Content="Сканировать" Click="ScanButton_Click" Margin="0,0,10,0" Height="75" Width="75" BorderThickness="1,1,1,1" RenderTransformOrigin="0,0"/>
            <StackPanel Width="75" Margin="0,0,10,0">
                <Button x:Name="CancelButton" Content="Прервать" Click="CancelButton_Click" IsEnabled="False" Width="75" Height="32.5" VerticalAlignment="Top" Margin="0,0,0,10"/>
                <Button x:Name="ClearButton" Content="Очистить" Click="ClearList_Click" IsEnabled="True" Width="75" Height="32.5" VerticalAlignment="Bottom"/>
            </StackPanel>
            <Button x:Name="ExportButton" Content="Экспорт" Click="ExportButton_Click" IsEnabled="False" Width="75" Height="75" ToolTipService.ShowOnDisabled="True" ToolTip="Зажмите CTRL что бы начать экспорт без предварителього сканирования"/>
        </StackPanel>
        <Border Grid.Row="4" Background="LightGray" Height="25" VerticalAlignment="Center">
            <StackPanel x:Name="BottomPanel" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left" Opacity="0.75">
                <TextBlock x:Name="ProjectName" Text="Проект: " Foreground="Black" Margin="10,0"/>
                <Separator Width="16" Margin="10,0,10,0" Background="#FFADADAD" UseLayoutRounding="False" Cursor="" VerticalContentAlignment="Center" ScrollViewer.VerticalScrollBarVisibility="Disabled" RenderTransformOrigin="0.5,0.5">
                    <Separator.RenderTransform>
                        <TransformGroup>
                            <RotateTransform Angle="-90"/>
                            <TranslateTransform/>
                        </TransformGroup>
                    </Separator.RenderTransform>
                </Separator>
                <TextBlock x:Name="FileCountLabelBottom" Text="Найдено файлов для экспорта: " Foreground="Black" Margin="10,0"/>
                <Separator Width="16" Margin="10,0,10,0" Background="#FFADADAD" UseLayoutRounding="False" Cursor="" VerticalContentAlignment="Center" ScrollViewer.VerticalScrollBarVisibility="Disabled" RenderTransformOrigin="0.5,0.5">
                    <Separator.RenderTransform>
                        <TransformGroup>
                            <RotateTransform Angle="-90"/>
                            <TranslateTransform/>
                        </TransformGroup>
                    </Separator.RenderTransform>
                </Separator>
                <TextBlock>
                    <Run Text="Состояние модели: "/>
                    <Run x:Name="ModelStateInfoRunBottom" Foreground="Red"/>
                </TextBlock>
            </StackPanel>
        </Border>
        <TabControl Margin="10,10,10,10" Grid.Row="1">
            <TabItem Header="Основные">
                <Grid Background="White">
                    <GroupBox Header="Фильтрация компонентов" Margin="1220,10,0,0" Height="140" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <StackPanel Margin="10,5,10,5">
                            <CheckBox x:Name="ExcludeReferencePartsCheckBox" Content="Исключить ссылочные" IsChecked="True" Margin="0,0,0,5"/>
                            <CheckBox x:Name="ExcludePurchasedPartsCheckBox" Content="Исключить покупные" IsChecked="True" Margin="0,0,0,5"/>
                            <CheckBox x:Name="IncludeLibraryComponentsCheckBox" Content="Включить библиотечные компоненты" IsChecked="False" Margin="0,0,0,5"/>
                        </StackPanel>
                    </GroupBox>
                    <GroupBox Header="Папка экспорта" Margin="732,10,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" Height="140">
                        <Grid Margin="10,5,10,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="85*"/>
                                <RowDefinition Height="27*"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Левая колонка -->
                            <StackPanel Orientation="Vertical" Grid.Column="0">
                                <RadioButton x:Name="ChooseFolderRadioButton" Content="Указать папку в процессе экспорта" Margin="0,5,0,0" GroupName="ExportFolderOptions" Checked="ChooseFolderRadioButton_Checked" />
                                <RadioButton x:Name="ComponentFolderRadioButton" Content="Папка компонента" Margin="0,5,0,0" GroupName="ExportFolderOptions" Checked="ComponentFolderRadioButton_Checked" />
                                <RadioButton x:Name="PartFolderRadioButton" Content="Рядом с деталью" Margin="0,5,0,0" GroupName="ExportFolderOptions" Checked="PartFolderRadioButton_Checked" />
                                <RadioButton x:Name="ProjectFolderRadioButton" Content="Папка проекта" VerticalAlignment="Center" GroupName="ExportFolderOptions" Checked="ProjectFolderRadioButton_Checked" Margin="0,5,0,0" />
                            </StackPanel>
                            <!-- Правая колонка -->
                            <StackPanel Grid.Row="0" Grid.Column="1">
                                <CheckBox x:Name="EnableSubfolderCheckBox" Content="Создать подпапку" VerticalAlignment="Center" IsEnabled="False" Checked="EnableSubfolderCheckBox_Checked" Unchecked="EnableSubfolderCheckBox_Unchecked" ToolTip="Недопустимые символы: \ / : * ? &quot; &lt; &gt; |" Margin="50,5,0,0" HorizontalAlignment="Left" />
                                <TextBox x:Name="SubfolderNameTextBox" Width="118" Height="20" IsEnabled="False" TextChanged="SubfolderNameTextBox_TextChanged" HorizontalAlignment="Left" Margin="50,5,0,0" />
                                <CheckBox x:Name="OrganizeByMaterialCheckBox" Content="Сортировать по материалу" Margin="50,5,0,0"/>
                                <CheckBox x:Name="OrganizeByThicknessCheckBox" Content="Сортировать по толщине" Margin="50,5,0,0"/>
                            </StackPanel>

                            <StackPanel Grid.Row="1" VerticalAlignment="Center" Orientation="Horizontal" HorizontalAlignment="Left" Grid.ColumnSpan="2"
                                        Grid.Column="0">
                                <RadioButton x:Name="FixedFolderRadioButton" Content="Фиксированная папка" VerticalAlignment="Center" GroupName="ExportFolderOptions" Checked="FixedFolderRadioButton_Checked" />
                                <Button x:Name="SelectFixedFolderButton" Content="..." Width="30" Height="20" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,0,0" Click="SelectFixedFolderButton_Click" />
                                <TextBlock x:Name="FixedFolderPathTextBlock" Text="Путь не выбран" Margin="10,0,0,0" TextTrimming="CharacterEllipsis" Opacity="0.75" VerticalAlignment="Center" Width="260" />
                            </StackPanel>

                        </Grid>
                    </GroupBox>


                    <GroupBox Header="Базовые настройки" Margin="10,10,0,0" Height="140" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <StackPanel Margin="10,5,10,5" HorizontalAlignment="Center" VerticalAlignment="Top">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <RadioButton x:Name="TraverseRadioButton" Content="Перебор" IsChecked="False" Margin="0,0,10,0"/>
                                <RadioButton x:Name="BomRadioButton" Content="Спецификация" IsChecked="True"/>
                            </StackPanel>
                            <CheckBox x:Name="IncludeQuantityInFileNameCheckBox" Content="Записать количество в имя файла" Margin="0,0,0,5"
                                Checked="IncludeQuantityInFileNameCheckBox_CheckedChanged"
                                Unchecked="IncludeQuantityInFileNameCheckBox_CheckedChanged"/>
                        </StackPanel>
                    </GroupBox>
                    <GroupBox Header="Настройки экспорта DXF" Margin="254,10,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" Height="140">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" Margin="10,5,10,0">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Content="Версия AutoCAD:" VerticalAlignment="Center"/>
                                <ComboBox x:Name="AcadVersionComboBox" Width="70" SelectedIndex="5" Height="20" VerticalContentAlignment="Center" Padding="5,0,5,0">
                                    <ComboBoxItem Content="2018"/>
                                    <ComboBoxItem Content="2013"/>
                                    <ComboBoxItem Content="2010"/>
                                    <ComboBoxItem Content="2007"/>
                                    <ComboBoxItem Content="2004"/>
                                    <ComboBoxItem Content="2000"/>
                                    <ComboBoxItem Content="R12"/>
                                </ComboBox>
                            </StackPanel>
                            <CheckBox x:Name="MergeProfilesIntoPolylineCheckBox" Content="Объеденить контуры с полилиниями" Margin="0,0,0,5" IsChecked="True"/>
                            <CheckBox x:Name="RebaseGeometryCheckBox" Content="Переместить геометрию в первый квадрант" Margin="0,0,0,5" IsChecked="True"/>
                            <CheckBox x:Name="TrimCenterlinesCheckBox" Content="Обрезать осевые линии по контуру" Margin="0,0,0,5"/>
                        </StackPanel>
                    </GroupBox>
                    <StackPanel Orientation="Horizontal" Margin="0,0,10,10" Height="25" VerticalAlignment="Bottom" HorizontalAlignment="Right" Width="134">
                        <Label Content="Множитель" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <Grid Width="50">
                            <!-- Размер поля ввода вернулся к 50 -->
                            <TextBox x:Name="MultiplierTextBox" Width="50" IsEnabled="False" Text="1" Height="22" VerticalAlignment="Center" 
                 PreviewTextInput="MultiplierTextBox_PreviewTextInput" 
                 VerticalContentAlignment="Center" 
                 TextChanged="MultiplierTextBox_TextChanged"/>
                            <Button x:Name="ClearMultiplierButton" 
                Content="✖" 
                Width="20" 
                Height="20" 
                HorizontalAlignment="Right" 
                VerticalAlignment="Center" 
                Click="ClearMultiplierButton_Click" 
                FontSize="8" 
                Background="{x:Null}" 
                Visibility="Collapsed" 
                ToolTip="Сбросить множитель на 1">
                                <Button.BorderBrush>
                                    <SolidColorBrush Color="#FF707070" Opacity="0"/>
                                </Button.BorderBrush>
                            </Button>
                        </Grid>
                    </StackPanel>
                    <GroupBox Header="Замена сплайнов " Margin="555,10,0,0" Height="140" HorizontalAlignment="Left" VerticalAlignment="Top">
                        <StackPanel Orientation="Vertical" Margin="10,5,10,0" VerticalAlignment="Top" HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <CheckBox x:Name="EnableSplineReplacementCheckBox" Content="Активация" Checked="EnableSplineReplacementCheckBox_CheckedChanged" Unchecked="EnableSplineReplacementCheckBox_CheckedChanged" VerticalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Content="Тип замены:" VerticalAlignment="Center" Padding="0,5,5,5"/>
                                <ComboBox x:Name="SplineReplacementComboBox" Width="65" VerticalContentAlignment="Center" IsEnabled="False" Height="20" Padding="5,0,5,0" Margin="2,0,0,0">
                                    <ComboBoxItem Content="Линии"/>
                                    <ComboBoxItem Content="Дуги"/>
                                </ComboBox>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Content="Допуск (мм):" VerticalAlignment="Center" Padding="0,5,5,5"/>
                                <TextBox x:Name="SplineToleranceTextBox" Width="65" Text="0.01" VerticalContentAlignment="Center" IsEnabled="False" Height="20"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </TabItem>
            <TabItem Header="Настройка слоев">
                <Grid Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="210"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Margin="10,0,10,0">
                        <layer:LayerSettingControl x:Name="OuterProfileLayerControl" DataContext="{Binding LayerSettings[5]}" Pseudonym="OuterProfile"/>
                        <layer:LayerSettingControl x:Name="InteriorProfilesLayerControl" DataContext="{Binding LayerSettings[6]}" Pseudonym="InteriorProfiles"/>
                        <layer:LayerSettingControl x:Name="BendUpLayerControl" DataContext="{Binding LayerSettings[0]}" Pseudonym="BendUp"/>
                        <layer:LayerSettingControl x:Name="BendDownLayerControl" DataContext="{Binding LayerSettings[1]}" Pseudonym="BendDown"/>
                        <layer:LayerSettingControl x:Name="ToolCenterUpLayerControl" DataContext="{Binding LayerSettings[2]}" Pseudonym="ToolCenterUp"/>
                        <layer:LayerSettingControl x:Name="ToolCenterDownLayerControl" DataContext="{Binding LayerSettings[3]}" Pseudonym="ToolCenterDown"/>
                    </StackPanel>
                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,10,0">
                        <layer:LayerSettingControl x:Name="TangentLayerControl" DataContext="{Binding LayerSettings[12]}" Pseudonym="Tangent"/>
                        <layer:LayerSettingControl x:Name="RollLinesLayerControl" DataContext="{Binding LayerSettings[14]}" Pseudonym="RollLines"/>
                        <layer:LayerSettingControl x:Name="TangentRollLinesLayerControl" DataContext="{Binding LayerSettings[13]}" Pseudonym="TangentRollLines"/>
                        <layer:LayerSettingControl x:Name="ArcCentersLayerControl" DataContext="{Binding LayerSettings[4]}" Pseudonym="ArcCenters"/>
                        <layer:LayerSettingControl x:Name="FeatureProfilesUpLayerControl" DataContext="{Binding LayerSettings[7]}" Pseudonym="FeatureProfilesUp"/>
                        <layer:LayerSettingControl x:Name="FeatureProfilesDownLayerControl" DataContext="{Binding LayerSettings[8]}" Pseudonym="FeatureProfilesDown"/>
                    </StackPanel>
                    <StackPanel Grid.Row="0" Grid.Column="2" Margin="10,0,10,0">
                        <layer:LayerSettingControl x:Name="UnconsumedSketchConstructionLayerControl" DataContext="{Binding LayerSettings[15]}" Pseudonym="UnconsumedSketchConstruction"/>
                        <layer:LayerSettingControl x:Name="UnconsumedSketchesLayerControl" DataContext="{Binding LayerSettings[11]}" Pseudonym="UnconsumedSketches"/>
                        <layer:LayerSettingControl x:Name="AltRepFrontLayerControl" DataContext="{Binding LayerSettings[9]}" Pseudonym="AltRepFront"/>
                        <layer:LayerSettingControl x:Name="AltRepBackLayerControl" DataContext="{Binding LayerSettings[10]}" Pseudonym="AltRepBack"/>
                    </StackPanel>
                    <Separator Background="#FF969595" RenderTransformOrigin="0.5,0.5" HorizontalAlignment="Center" Width="185"
                               Grid.Row="0" Grid.ColumnSpan="2" Grid.Column="0" Margin="0,5,0,20">
                        <Separator.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform/>
                                <SkewTransform/>
                                <RotateTransform Angle="90"/>
                                <TranslateTransform/>
                            </TransformGroup>
                        </Separator.RenderTransform>
                    </Separator>
                    <Separator Background="#FF969595" RenderTransformOrigin="0.5,0.5" HorizontalAlignment="Center" Width="185"
                               Grid.Row="0" Grid.ColumnSpan="2" Margin="0,5,0,20" Grid.Column="1">
                        <Separator.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform/>
                                <SkewTransform/>
                                <RotateTransform Angle="90"/>
                                <TranslateTransform/>
                            </TransformGroup>
                        </Separator.RenderTransform>
                    </Separator>
                </Grid>
            </TabItem>
            <TabItem Header="Имя выгружаемого файла"/>
        </TabControl>
        <TextBlock Name="VersionTextBlock" VerticalAlignment="Center" Margin="0,0,25,0" HorizontalAlignment="Right" Text="Версия программы: x.x.x.x + xxxxxxx" Grid.Row="4"/>
        <Button Content="About" Click="AboutButton_Click" Margin="0,14,10,186" FontSize="10" HorizontalAlignment="Right" Padding="1,1,1,1" Width="73" FontFamily="Tahoma" VerticalContentAlignment="Top" Cursor="Help" Grid.RowSpan="2" FontWeight="Bold">
            <Button.Background>
                <ImageBrush ImageSource="/Resources/Pic/Beta1.png" TileMode="None" Stretch="Uniform" Opacity="1">
                    <ImageBrush.RelativeTransform>
                        <TransformGroup>
                            <ScaleTransform CenterY="0.75" CenterX="0.5" ScaleY="0.75" ScaleX="0.75"/>
                            <SkewTransform CenterX="0.5" CenterY="0.75"/>
                            <RotateTransform CenterX="0.5" CenterY="0.75"/>
                            <TranslateTransform/>
                        </TransformGroup>
                    </ImageBrush.RelativeTransform>
                </ImageBrush>
            </Button.Background>
            <Button.Style>
                <Style TargetType="Button">
                    <!-- Убираем стандартный фон при наведении -->
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderBrush" Value="#FFACACAC"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,5,0,0"/>
                                    <!-- Прижимаем текст к верху -->
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>

                    <!-- Триггер для изменения границы при наведении -->
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="BorderBrush" Value="#0078D4"/>
                            <!-- Цвет границы при наведении -->
                            <Setter Property="BorderThickness" Value="1"/>
                            <!-- Увеличиваем толщину границы -->
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter Property="BorderBrush" Value="#003778"/>
                            <!-- Цвет границы при нажатии -->
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>
    </Grid>
</Window>
