# Инструкция по рефакторингу проекта FlatPatternExporter

## 1. Исходные файлы проекта

Прочитайте следующие файлы для понимания текущей структуры:

- **Бизнес-логика и UI-код** (смешаны в двух файлах):
  1. `@FlatPatternExporter\UI\Windows\FlatPatternExporterMainWindow.xaml.cs`
  2. `@FlatPatternExporter\UI\Windows\FlatPatternExporterMainWindow.xaml.part2.cs`

## 2. Основная задача

- Отделите всю бизнес-логику в отдельные компоненты, чтобы файлы в папке `UI` (включая одноимённые XAML и CS-файлы) отвечали исключительно за пользовательский интерфейс (UI).
- При определении новой структуры избегайте чрезмерного дробления: выделите основные блоки, такие как подключение к Inventor, сканирование, экспорт и аналогичные логические модули.
- В процессе рефакторинга сохраните существующий функционал без добавлений или удалений. Ограничьтесь только разделением логики на отдельные сервисы и компоненты.

## 3. План рефакторинга

После определения новой файловой структуры создайте файл `plan.md`, где опишите:

- Новую структуру проекта (включая имена файлов, директорий и их назначение).
- Промежуточные фиксации в конце создания каждого нового файла.

**Этапы рефакторинга** (выполняйте последовательно, с фиксацией после каждого):

1. **Определение структуры**:
   - Проанализируйте исходные файлы и выделите ключевые блоки бизнес-логики.
   - Опишите в `plan.md` предлагаемую структуру (например, новые классы/сервисы в отдельной папке, такие как `Core` или `Services`).

2. **Перенос бизнес-логики**:
   - Создавайте новые файлы по одному, перенося соответствующие фрагменты кода из исходных файлов.
   - После переноса в новый файл:
     - Удалите перенесённый код из исходных файлов (`FlatPatternExporterMainWindow.xaml.cs` и `.part2.cs`).
     - Убедитесь, что исходные файлы содержат только UI-логику.
   - Акцент на удалении: Перед фиксацией проверьте, что весь перенесённый код удалён из исходных файлов, чтобы избежать дублирования.

3. **Проверка и фиксация**:
   - После создания каждого нового файла:
     - Соберите проект и проверьте на наличие ошибок компиляции.
     - Перепроверьте корректность переноса: убедитесь, что функционал не изменился и нет дубликатов.
     - Зафиксируйте в `plan.md`: опишите изменения, результаты сборки и проверки.
   - Остановитесь после каждого этапа и запросите подтверждение для перехода к следующему.

4. **Обработка ошибок сборки**:
   - Если возникнут сообщения о дублирующихся членах (например, "Тип 'FlatPatternExporterMainWindow' уже определяет член 'MemberName' с такими же типами параметров"), проверьте, что член не был добавлен заново, а существовал в других файлах. Пересогласуйте логику переноса.
   - Если возникнут конфликты имён (например, "PropertyManager" конфликтует с "System.Windows.Forms.PropertyManager"), используйте полное имя (например, "Core.PropertyManager"), без переименования свойств или файлов.

**Дополнительные правила**:
- Не применяйте паттерн MVVM, так как он избыточен на данном этапе.
- Фиксация работы только в файле `plan.md` (без использования GIT или других систем версионного контроля).

## 4. Пояснения и ограничения

- Избегайте изменений в файлах, не указанных в инструкции.
- Убедитесь, что рефакторинг не влияет на другие части кодовой базы.

## 5. Финальная стадия

- После завершения переноса всей бизнес-логики из файлов `FlatPatternExporterMainWindow.xaml.cs` и `FlatPatternExporterMainWindow.xaml.part2.cs`:
  - Перенесите остатки UI-кода из `.part2.cs` в основной файл `.cs`.
  - Удалите файл `.part2.cs`, поскольку разделение на два файла больше не требуется.
- Зафиксируйте финальные изменения в `plan.md`, соберите проект и подтвердите отсутствие ошибок.